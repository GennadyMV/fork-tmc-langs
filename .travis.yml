language: java
sudo: false
cache:
  directories:
    - "$HOME/.m2"
addons:
  apt:
    sources:
      - deadsnakes
    packages:
      - valgrind
      - check
      - python3.4
env:
  - M3_HOME=/usr/local/maven
before_install:
  - env
  - curl -L https://static.rust-lang.org/rustup.sh | sh -s -- --channel=nightly --yes --prefix=$PWD --disable-sudo
  - export PATH=$PATH:$PWD/bin
  - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PWD/lib
  - mkdir $HOME/bin && ln -s $(which python3.4) $HOME/bin/python3 && export PATH="$HOME/bin:$PATH"
  - mvn install -Dmaven.test.skip=true
script:
  - mvn clean test
  - mvn checkstyle:check
  - . ./clitest.sh
after_success:
  - mvn clean cobertura:cobertura org.eluder.coveralls:coveralls-maven-plugin:report
os:
  - linux
  - osx
jdk:
  - oraclejdk8
  - oraclejdk7
  - openjdk7
matrix:
  allow_failures:
  - os: osx
notifications:
  slack:
    secure: elwVbriXdc/RkeP3UfVpSC0N6mbdk60ro7Pu1+2ddktmgQIEHjAVSdzpy2FLGTz/gK2MEXo2XU1rSg3t8GqlJNh1RTASzhyhcCUJTa7UdKe84mcRWDxJffunQKsBpUJv71tXBy1OyL8pcdnw1qkpr5NDyqXvBk67VwepVqy8em4=
